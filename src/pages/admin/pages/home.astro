---
/**
 * admin/pages/home.astro
 * 
 * Página de edição da Home (singleton).
 */

import { getEntry } from 'astro:content';
import AdminLayout from '../../../layouts/AdminLayout.astro';
import HomeEditor from '../../../components/admin/HomeEditor.tsx';
import { readSingleton } from '../../../utils/singleton-utils';

// Obter tema ativo
const settings = await getEntry('siteSettings', 'settings');
const activeThemeId = settings?.data?.activeTheme || 'classic';

const initialData = await readSingleton('home', activeThemeId);
---

<AdminLayout title="Página Inicial - CNX Agency Admin">
    <div id="home-editor-wrapper" class="min-h-[400px]">
        {initialData ? (
            <HomeEditor 
                client:only="react"
                initialData={initialData}
            />
        ) : (
            <div class="p-8 text-center">
                <p class="text-[#a3a3a3] mb-4">Carregando dados da página inicial...</p>
                <p class="text-[#737373] text-sm">Se esta mensagem persistir, verifique se o arquivo home.yaml existe para o tema {activeThemeId}.</p>
            </div>
        )}
    </div>
    <noscript>
        <div class="p-8 text-center">
            <p class="text-[#a3a3a3] mb-4">JavaScript é necessário para editar páginas.</p>
        </div>
    </noscript>
</AdminLayout>
