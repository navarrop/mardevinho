---
/**
 * Header.astro
 *
 * Barra de topo do painel admin (estilo WordPress) + header principal.
 * Inclui bot√£o de toggle dark/light mode que salva a prefer√™ncia no localStorage.
 */

interface Props {
    user?: { slug: string; name: string; adminRole: 'admin' | 'editor' } | undefined;
}

const { user } = Astro.props;
const firstName = user?.name?.split(' ')[0] ?? '';
const initials  = user?.name
    ? user.name.split(' ').slice(0, 2).map((w: string) => w[0].toUpperCase()).join('')
    : '?';
const isAdmin = user?.adminRole === 'admin';
---

<!-- ‚ïê‚ïê Barra WP-style ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div
    class="h-8 flex items-center justify-between px-4 flex-shrink-0"
    style="background: var(--admin-bar-bg); border-bottom: 1px solid var(--admin-bar-border);"
>
    <!-- Esquerda -->
    <div class="flex items-center gap-0.5">
        <a href="/admin"
           class="flex items-center gap-1.5 px-2 py-1 rounded text-xs font-semibold transition-all"
           style="color: var(--admin-bar-text);"
           onmouseover="this.style.color='var(--admin-bar-text-hover)';this.style.background='var(--admin-bar-hover-bg)'"
           onmouseout="this.style.color='var(--admin-bar-text)';this.style.background='transparent'">
            <span class="text-[10px] font-black px-1.5 py-0.5 rounded" style="background: rgba(255,255,255,0.1);">CNX</span>
            <span class="hidden sm:inline">Admin</span>
        </a>

        <span class="mx-1" style="color: rgba(255,255,255,0.1);">|</span>

        <a href="/" target="_blank" rel="noopener"
           class="flex items-center gap-1 px-2 py-1 rounded text-xs transition-all"
           style="color: var(--admin-bar-text);"
           onmouseover="this.style.color='var(--admin-bar-text-hover)';this.style.background='var(--admin-bar-hover-bg)'"
           onmouseout="this.style.color='var(--admin-bar-text)';this.style.background='transparent'">
            <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span class="hidden sm:inline">Ver site</span>
        </a>

        <a href="/admin/posts/new"
           class="flex items-center gap-1 px-2 py-1 rounded text-xs transition-all"
           style="color: var(--admin-bar-text);"
           onmouseover="this.style.color='var(--admin-bar-text-hover)';this.style.background='var(--admin-bar-hover-bg)'"
           onmouseout="this.style.color='var(--admin-bar-text)';this.style.background='transparent'">
            <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            <span class="hidden sm:inline">Novo post</span>
        </a>
    </div>

    <!-- Direita: usu√°rio + toggle tema + sair -->
    <div class="flex items-center gap-1">
        {user ? (
            <>
                <div class="flex items-center gap-2 px-2 py-1">
                    <!-- Avatar -->
                    <div class={`w-5 h-5 rounded-full flex items-center justify-center text-[9px] font-bold flex-shrink-0
                        ${isAdmin ? 'bg-violet-500/30 text-violet-300 ring-1 ring-violet-500/40'
                                  : 'bg-sky-500/30 text-sky-300 ring-1 ring-sky-500/40'}`}>
                        {initials}
                    </div>
                    <!-- Nome -->
                    <span class="text-xs hidden sm:inline" style="color: var(--admin-bar-text);">
                        Ol√°, <strong style="color: var(--admin-bar-text-hover);" class="font-semibold">{firstName}</strong>
                    </span>
                    <!-- Badge de role -->
                    <span class={`text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded hidden md:inline
                        ${isAdmin ? 'text-violet-400 bg-violet-500/10 ring-1 ring-violet-500/20'
                                  : 'text-sky-400 bg-sky-500/10 ring-1 ring-sky-500/20'}`}>
                        {isAdmin ? 'Admin' : 'Editor'}
                    </span>
                </div>

                <span class="text-sm mx-1" style="color: rgba(255,255,255,0.1);">|</span>

                <!-- Sair -->
                <a href="/api/admin/auth/logout"
                   class="flex items-center gap-1.5 px-2 py-1 rounded text-xs font-medium transition-all"
                   style="color: var(--admin-bar-text);"
                   onmouseover="this.style.color='#f87171';this.style.background='rgba(239,68,68,0.1)'"
                   onmouseout="this.style.color='var(--admin-bar-text)';this.style.background='transparent'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    <span>Sair</span>
                </a>
            </>
        ) : (
            <a href="/admin/login"
               class="px-2 py-1 rounded text-xs transition-all"
               style="color: var(--admin-bar-text);">
                Entrar
            </a>
        )}
    </div>
</div>

<!-- ‚ïê‚ïê Header principal ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<header
    class="h-12 flex items-center justify-between px-4 md:px-6 flex-shrink-0"
    style="background: var(--admin-surface); border-bottom: 1px solid var(--admin-border);"
>
    <div class="flex items-center gap-3 flex-1 min-w-0">
        <!-- Busca -->
        <div
            class="hidden lg:flex items-center gap-2 px-3 py-1.5 rounded-lg max-w-xs flex-1"
            style="background: var(--admin-search-bg); border: 1px solid var(--admin-border);"
        >
            <span class="text-xs" style="color: var(--admin-text-subtle);">üîç</span>
            <input
                type="text"
                placeholder="Buscar..."
                disabled
                class="bg-transparent border-0 outline-0 flex-1 text-xs cursor-not-allowed"
                style="color: var(--admin-input-text);"
            />
        </div>
    </div>

    <div class="flex items-center gap-2">
        <!-- Bot√£o toggle dark/light -->
        <button
            id="theme-toggle"
            title="Alternar tema"
            aria-label="Alternar entre modo claro e escuro"
            class="w-8 h-8 flex items-center justify-center rounded-lg transition-all text-sm"
            style="background: var(--admin-surface-hover); border: 1px solid var(--admin-border); color: var(--admin-text-muted);"
        >
            <span id="theme-icon">üåô</span>
        </button>

        <a href="/admin/posts/new" class="admin-btn admin-btn-primary text-sm">+ Novo Post</a>
    </div>
</header>

<script is:inline>
(function () {
    function applyThemeIcon() {
        var icon = document.getElementById('theme-icon');
        if (!icon) return;
        var isLight = document.documentElement.classList.contains('light');
        icon.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
    }

    function toggleTheme() {
        var html = document.documentElement;
        var isCurrentlyLight = html.classList.contains('light');
        html.classList.remove('dark', 'light');
        var next = isCurrentlyLight ? 'dark' : 'light';
        html.classList.add(next);
        try { localStorage.setItem('cnx-theme', next); } catch (e) {}
        applyThemeIcon();
    }

    document.addEventListener('DOMContentLoaded', function () {
        applyThemeIcon();
        var btn = document.getElementById('theme-toggle');
        if (btn) btn.addEventListener('click', toggleTheme);
    });
})();
</script>
